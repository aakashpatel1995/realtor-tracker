<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Realtor Tracker Dashboard</title>
  <link rel="stylesheet" href="dashboard.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>Realtor Tracker Dashboard</h1>
      <p class="subtitle">Greater Toronto Area Real Estate Listings</p>
    </header>

    <div id="config-banner" class="config-banner">
      <p>Configure your Google Sheets connection to view statistics</p>
      <button id="showConfigBtn" class="btn btn-white">Configure Now</button>
    </div>

    <div id="config-modal" class="modal hidden">
      <div class="modal-content">
        <h2>Google Sheets Configuration</h2>
        <div class="input-group">
          <label for="scriptUrl">Google Apps Script URL:</label>
          <input type="text" id="scriptUrl" placeholder="https://script.google.com/macros/s/.../exec">
          <small>Deploy your Apps Script as a web app and paste the URL here</small>
        </div>
        <div class="modal-actions">
          <button id="saveConfigBtn" class="btn btn-primary">Save & Load Data</button>
          <button id="cancelConfigBtn" class="btn btn-secondary">Cancel</button>
        </div>
      </div>
    </div>

    <main>
      <section class="stats-section">
        <h2>Listing Statistics</h2>
        <div class="stats-grid">
          <div class="stat-card new-today">
            <div class="stat-icon">+</div>
            <div class="stat-value" id="newToday">-</div>
            <div class="stat-label">New Today</div>
            <div class="stat-description">Listings added today</div>
          </div>
          <div class="stat-card new-week">
            <div class="stat-icon">7d</div>
            <div class="stat-value" id="newLast7Days">-</div>
            <div class="stat-label">Last 7 Days</div>
            <div class="stat-description">New listings this week</div>
          </div>
          <div class="stat-card new-weeks">
            <div class="stat-icon">7w</div>
            <div class="stat-value" id="newLast7Weeks">-</div>
            <div class="stat-label">Last 7 Weeks</div>
            <div class="stat-description">New listings (49 days)</div>
          </div>
          <div class="stat-card sold">
            <div class="stat-icon">-</div>
            <div class="stat-value" id="soldToday">-</div>
            <div class="stat-label">Sold/Delisted Today</div>
            <div class="stat-description">Removed from market</div>
          </div>
        </div>

        <div class="total-card">
          <div class="total-icon">ALL</div>
          <div class="total-content">
            <div class="total-value" id="totalActive">-</div>
            <div class="total-label">Total Active Listings</div>
          </div>
        </div>
      </section>

      <section class="breakdown-section">
        <h2>By Listing Type</h2>
        <div class="breakdown-grid">
          <div class="breakdown-card">
            <h3>For Sale</h3>
            <div class="breakdown-value" id="saleCount">-</div>
            <div class="breakdown-bar">
              <div class="breakdown-fill sale-fill" id="saleFill"></div>
            </div>
          </div>
          <div class="breakdown-card">
            <h3>For Rent</h3>
            <div class="breakdown-value" id="rentCount">-</div>
            <div class="breakdown-bar">
              <div class="breakdown-fill rent-fill" id="rentFill"></div>
            </div>
          </div>
        </div>
      </section>

      <section class="history-section">
        <h2>Recent Activity</h2>
        <div id="historyTable" class="history-table">
          <div class="history-loading">Loading history...</div>
        </div>
      </section>

      <section class="listings-section">
        <div class="listings-header-row">
          <h2>Listings by Age</h2>
          <div class="filter-controls">
            <div class="filter-group">
              <label for="cityFilter">City:</label>
              <select id="cityFilter" class="filter-select">
                <option value="">All Cities</option>
              </select>
            </div>
            <div class="filter-group">
              <label for="postalFilter">Postal Code:</label>
              <input type="text" id="postalFilter" class="filter-input" placeholder="e.g. L1S or M5V">
            </div>
            <div class="filter-group">
              <label for="sortBy">Sort by:</label>
              <select id="sortBy" class="filter-select">
                <option value="date-newest">Newest First</option>
                <option value="date-oldest">Oldest First</option>
                <option value="price-low">Price: Low to High</option>
                <option value="price-high">Price: High to Low</option>
                <option value="city">City A-Z</option>
                <option value="postal">Postal Code</option>
              </select>
            </div>
          </div>
        </div>
        <div class="age-tabs">
          <button class="age-tab recent-tab active" data-age="recent">Recently Added <span id="countRecent">0</span></button>
          <button class="age-tab" data-age="today">New Today <span id="countToday">0</span></button>
          <button class="age-tab sold-tab" data-age="sold">Sold/Delisted <span id="countSold">0</span></button>
          <button class="age-tab" data-age="7">7+ Days <span id="count7">0</span></button>
          <button class="age-tab" data-age="30">30+ Days <span id="count30">0</span></button>
          <button class="age-tab" data-age="90">90+ Days <span id="count90">0</span></button>
          <button class="age-tab" data-age="365">1+ Year <span id="count365">0</span></button>
        </div>
        <div id="listingsContainer" class="listings-container">
          <div class="listings-loading">Loading listings...</div>
        </div>
      </section>
    </main>

    <footer>
      <div class="footer-content">
        <div class="last-update">
          Last updated: <span id="lastUpdate">Never</span>
        </div>
        <div class="auto-refresh">
          <label>
            <input type="checkbox" id="autoRefresh" checked>
            Auto-refresh every 5 minutes
          </label>
        </div>
        <button id="refreshBtn" class="btn btn-primary">
          <span id="refreshText">Refresh Now</span>
          <span id="refreshSpinner" class="spinner hidden"></span>
        </button>
        <button id="settingsBtn" class="btn btn-secondary">Settings</button>
      </div>
    </footer>
  </div>

  <div id="toast" class="toast hidden"></div>

  <script src="dashboard.js"></script>
</body>
</html>
